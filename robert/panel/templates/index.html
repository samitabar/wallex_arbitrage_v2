<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <title>Wallex-Nobitex Arbitrage</title>
</head>

<body>
<!--   create header bar-->
<nav class="navbar navbar-expand-lg justify-content-center shadow mb-2" style="background-color: #F3F4F6">
    <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="/api/v1/data">Api Data</a>
            </li>
        </ul>
    </div>
    <div class="mx-auto order-0">
        <a class="navbar-brand" href="#" style="color: #F2B80C;">
            Wallex-Nobitex Arbitrage
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
    <div class="collapse navbar-collapse collapse w-100 order-3 dual-collapse2" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto ml-auto mb-2 mb-lg-0 d-flex">
            <li class="nav-item mx-1 rounded">
                <span id="time">Last Fetch: </span>
            </li>
        </ul>
    </div>
</nav>
<br>
<br>
<br>
<div class="container-fluid">
    <div class="row">
        <div class="col" id="buy_from_wallex_col">
            <p class="text-center h-auto">Buy: <span style="color: #0C68F4">Wallex</span> &emsp; | &emsp; Sell: <span
                    style="color: #784ED1">Nobitex</span></p>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="col" id="buy_from_nobitex_col">
            <p class="text-center h-auto">Buy: <span style="color: #784ED1">Nobitex</span> &emsp; | &emsp; Sell: <span
                    style="color: #0C68F4">Wallex</span></p>
        </div>
    </div>
</div>
</body>

<script type="application/javascript">
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }

    function get_data(url, callback) {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(xhr.responseText);
            }
        }
        xhr.onerror = function () {
            console.error("error");
        }
        xhr.open("GET", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Authorization", "root-test");
        xhr.send();
    }

    function update_data(data) {
        let time = document.getElementById("time");
        time.innerHTML = "Last Fetch: " + new Date().toLocaleTimeString();

        let table_element1 = document.getElementById("buy_from_wallex_table");
        if (table_element1) {
            table_element1.parentNode.removeChild(table_element1);
        }

        let table_element2 = document.getElementById("buy_from_nobitex_table");
        if (table_element2) {
            table_element2.parentNode.removeChild(table_element2);
        }

        let json = JSON.parse(data);
        let buy_from_wallex_data = json.buy_from_wallex;
        let buy_from_nobitex_data = json.buy_from_nobitex;

        let table = document.createElement('table');
        table.id = "buy_from_wallex_table";
        table.classList.add('center');
        table.classList.add('table');
        table.classList.add('table-striped');
        table.classList.add('table-hover');

        let thead = document.createElement('thead');
        let tr = document.createElement('tr');

        let th = document.createElement('th');
        th.innerHTML = "symbol";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Wallex Price";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Nobitex Price";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Wallex Quantity";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Nobitex Quantity";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Wallex volume";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Nobitex Volume";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Rate";
        tr.appendChild(th);

        th = document.createElement('th');
        th.innerHTML = "Profit";
        tr.appendChild(th);

        thead.appendChild(tr);
        table.appendChild(thead);

        for (let i = 0; i < buy_from_wallex_data.length; i++) {
            let row = table.insertRow();

            let objects = [
                {'name': 'wallex', 'value': parseFloat(buy_from_wallex_data[i]['orders']['wallex']['quantity'])},
                {'name': 'nobitex', 'value': parseFloat(buy_from_wallex_data[i]['orders']['nobitex']['quantity'])}
            ]
            let minimum = objects.reduce(function (obj1, obj2) {
                return (obj1.value < obj2.value) ? obj1 : obj2;
            });

            row.insertCell().innerHTML = buy_from_wallex_data[i]['symbol'];

            let wallex_price_cell = row.insertCell()
            wallex_price_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['wallex']['price']);
            let nobitex_price_cell = row.insertCell()
            nobitex_price_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['nobitex']['price']);

            let wallex_quantity_cell = row.insertCell()
            wallex_quantity_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['wallex']['quantity']);
            let nobitex_quantity_cell = row.insertCell()
            nobitex_quantity_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['nobitex']['quantity']);

            let wallex_volume_cell = row.insertCell()
            wallex_volume_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['wallex']['volume']);
            let nobitex_volume_cell = row.insertCell()
            nobitex_volume_cell.innerHTML = numberWithCommas(buy_from_wallex_data[i]['orders']['nobitex']['volume']);

            if (minimum.name === 'wallex') {
                wallex_quantity_cell.classList.add('text-primary');
                wallex_volume_cell.classList.add('text-primary');
            } else {
                nobitex_quantity_cell.classList.add('text-primary');
                nobitex_volume_cell.classList.add('text-primary');
            }

            let rate_cell = row.insertCell();
            let rate_data = parseFloat((parseFloat(buy_from_wallex_data[i]['rate']) / 100).toFixed(4))
            rate_cell.innerHTML = rate_data.toString() + '%';
            rate_cell.className = (rate_data > 0.02) ? 'text-success' : 'text-danger';

            let profit_cell = row.insertCell();
            let profit_data = parseFloat(buy_from_wallex_data[i]['orders'][minimum.name]['quantity']) * Math.abs(parseFloat(buy_from_wallex_data[i]['orders']['wallex']['price']) - parseFloat(buy_from_wallex_data[i]['orders']['nobitex']['price']));
            profit_cell.innerHTML = numberWithCommas(parseInt(profit_data.toString()));
            profit_cell.className = (profit_data > 0) ? 'text-success' : 'text-danger';
        }

        let table2 = document.createElement('table');
        table2.id = "buy_from_nobitex_table";
        table2.classList.add('center');
        table2.classList.add('table');
        table2.classList.add('table-striped');
        table2.classList.add('table-hover');

        let thead2 = document.createElement('thead');
        let tr2 = document.createElement('tr');

        let th2 = document.createElement('th');
        th2.innerHTML = "symbol";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Nobitex Price";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Wallex Price";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Nobitex Quantity";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Wallex Quantity";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Nobitex Volume";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Wallex volume";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Rate";
        tr2.appendChild(th2);

        th2 = document.createElement('th');
        th2.innerHTML = "Profit";
        tr2.appendChild(th2);

        thead2.appendChild(tr2);
        table2.appendChild(thead2);

        for (let i = 0; i < buy_from_nobitex_data.length; i++) {
            let row = table2.insertRow();

            let objects = [
                {'name': 'wallex', 'value': parseFloat(buy_from_nobitex_data[i]['orders']['wallex']['quantity'])},
                {'name': 'nobitex', 'value': parseFloat(buy_from_nobitex_data[i]['orders']['nobitex']['quantity'])}
            ]
            let minimum = objects.reduce(function (obj1, obj2) {
                return (obj1.value < obj2.value) ? obj1 : obj2;
            });

            row.insertCell().innerHTML = buy_from_nobitex_data[i]['symbol'];

            let wallex_price_cell = row.insertCell()
            wallex_price_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['wallex']['price']);
            let nobitex_price_cell = row.insertCell()
            nobitex_price_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['nobitex']['price']);

            let wallex_quantity_cell = row.insertCell()
            wallex_quantity_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['wallex']['quantity']);
            let nobitex_quantity_cell = row.insertCell()
            nobitex_quantity_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['nobitex']['quantity']);

            let wallex_volume_cell = row.insertCell()
            wallex_volume_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['wallex']['volume']);
            let nobitex_volume_cell = row.insertCell()
            nobitex_volume_cell.innerHTML = numberWithCommas(buy_from_nobitex_data[i]['orders']['nobitex']['volume']);

            if (minimum.name === 'wallex') {
                wallex_quantity_cell.classList.add('text-primary');
                wallex_volume_cell.classList.add('text-primary');
            } else {
                nobitex_quantity_cell.classList.add('text-primary');
                nobitex_volume_cell.classList.add('text-primary');
            }

            let rate_cell = row.insertCell();
            let rate_data = parseFloat((parseFloat(buy_from_nobitex_data[i]['rate']) / 100).toFixed(4))
            rate_cell.innerHTML = rate_data.toString() + '%';
            rate_cell.className = (rate_data > 0.02) ? 'text-success' : 'text-danger';

            let profit_cell = row.insertCell();
            let profit_data = parseFloat(buy_from_nobitex_data[i]['orders'][minimum.name]['quantity']) * Math.abs(parseFloat(buy_from_nobitex_data[i]['orders']['wallex']['price']) - parseFloat(buy_from_nobitex_data[i]['orders']['nobitex']['price']));
            profit_cell.innerHTML = numberWithCommas(parseInt(profit_data.toString()));
            profit_cell.className = (profit_data > 0) ? 'text-success' : 'text-danger';
        }

        let buy_from_wallex_col = document.getElementById('buy_from_wallex_col');
        let buy_from_nobitex_col = document.getElementById('buy_from_nobitex_col');

        buy_from_wallex_col.appendChild(table);
        buy_from_nobitex_col.appendChild(table2);
    }

    get_data("/api/v1/data", update_data);
    setInterval(function () {
        get_data("/api/v1/data", update_data);
    }, 5000);
</script>
</html>
